# CLIPLabeler.label_masks()

[Back to CLIP Labeler](../vision_clip_labeler.md)

## Related User Story
"As a user, I want EDI to understand my image's composition so it knows what can be safely edited." (from PRD)

## Function Signature
`label_masks(image, masks) -> List[Entity]`

## Parameters
- `image` - The original image that was segmented
- `masks` - A list of mask objects generated by the SAM analyzer

## Returns
- `List[Entity]` - A list of Entity objects with labels and confidence scores

## Step-by-step Logic
1. Take each mask region from the input masks list
2. Crop the corresponding region from the original image
3. Use CLIP to encode each cropped region
4. Compare mask regions to text labels via CLIP similarity
5. Assign labels based on CLIP text similarity (comparing to predefined labels like "sky", "building", "person", etc.)
6. Calculate confidence scores for each assigned label
7. Return a list of entities with IDs, labels, confidence scores, and other properties

## Performance Optimizations
- Batch processing of masks for efficiency
- Caching of text embeddings for common labels
- Skipping processing of very small masks (<2% of image area)

## Input/Output Data Structures
### Entity Object
An Entity object contains:
- ID (e.g., "sky_0")
- Label (e.g., "sky")
- Confidence score
- Bounding box coordinates
- Dominant color
- Area percentage